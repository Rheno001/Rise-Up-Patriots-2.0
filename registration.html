<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg" href="assets/URNI LOGO - ICON.svg">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <title>Registration Form</title>
    <!-- SweetAlert2 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
              font-family: "Montserrat", sans-serif;

        }

        body {
            font-family: "Montserrat", Arial, sans-serif;
            background-color: #f5f7fa;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-container {
            max-width: 1000px;
            width: 100%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 40px;
        }

        .form-header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .back-to-home {
            display: inline-flex;
            align-items: center;
            color: #2d5a3d;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 20px;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .back-to-home:hover {
            background-color: #f1ffef;
            border-color: #2d5a3d;
            transform: translateX(-2px);
        }

        .back-to-home:active {
            transform: translateX(0);
        }

        .form-header h1 {
            color: #2d5a3d;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .form-header p {
            color: #666;
            font-size: 1.1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .form-field {
            display: flex;
            flex-direction: column;
        }

        .form-field.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-weight: 600;
            color: #2d5a3d;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .required {
            color: #e74c3c;
        }

        .form-input {
            padding: 14px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: #fff;
            width: 100%;
            max-width: 100%;
        }

        .form-input:focus {
            outline: none;
            border-color: #2d5a3d;
            box-shadow: 0 0 0 3px rgba(45, 90, 61, 0.1);
        }

        .form-input::placeholder {
            color: #a0a9b8;
        }

        .form-select {
            padding: 14px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            background-color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23666" d="m0 0 2 2 2-2z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 12px;
            width: 100%;
            max-width: 100%;
        }

        .form-select:focus {
            outline: none;
            border-color: #2d5a3d;
            box-shadow: 0 0 0 3px rgba(45, 90, 61, 0.1);
        }

        .form-select:disabled {
            background-color: #f8f9fa;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .submit-btn {
            background: linear-gradient(135deg, #2d5a3d 0%, #1a4028 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(45, 90, 61, 0.3);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .loading {
            position: relative;
            color: transparent;
        }

        .loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .form-grid {
                grid-template-columns: 1fr;
                gap: 25px;
            }

            .form-field.full-width {
                grid-column: 1;
            }

            .submit-btn {
                width: 60%;
            }
        }

        @media (max-width: 768px) {
            .form-container {
                padding: 30px 20px;
            }

            .form-header h1 {
                font-size: 2rem;
            }

            .form-header p {
                font-size: 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .submit-btn {
                width: 100%;
            }
        }

        @media (max-width: 576px) {
            body {
                padding: 10px;
            }

            .form-container {
                padding: 25px 15px;
            }

            .form-header h1 {
                font-size: 1.8rem;
            }

            .form-header p {
                font-size: 0.95rem;
            }

            .form-input,
            .form-select {
                padding: 12px 14px;
                font-size: 0.95rem;
            }
        }

        @media (max-width: 400px) {
            .form-header h1 {
                font-size: 1.6rem;
            }

            .form-header p {
                font-size: 0.9rem;
            }

            .submit-btn {
                padding: 14px 20px;
                font-size: 1rem;
            }
        }

        /* Form validation styles */
        .form-input:invalid {
            border-color: #e74c3c;
        }

        .form-input:valid {
            border-color: #27ae60;
        }

        /* Loading state */
        .submit-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .submit-btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }
    </style>

</head>
<body>
    <div class="form-container">
        <div class="form-header">
            <a href="index.html" class="back-to-home">‚Üê Back to Homepage</a>
            <h1>Registration Form</h1>
            <p>Please fill out all required fields to complete your registration</p>
        </div>

        <form id="registrationForm" onsubmit="handleSubmit(event)">
            <div class="form-grid">
                <div class="form-field">
                    <label for="title" class="form-label">
                        Title<span class="required">*</span>
                    </label>
                    <select id="title" name="title" class="form-select" required>
                        <option value="">Select title</option>
                        <option value="Mr">Mr</option>
                        <option value="Mrs">Mrs</option>
                        <option value="Ms">Ms</option>
                        <option value="Dr">Dr</option>
                        <option value="Prof">Prof</option>
                    </select>
                </div>

                <div class="form-field">
                    <label for="gender" class="form-label">
                        Gender<span class="required">*</span>
                    </label>
                    <select id="gender" name="gender" class="form-select" required>
                        <option value="">Select gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        
                        <option value="Prefer not to say">Prefer not to say</option>
                    </select>
                </div>

                <div class="form-field">
                    <label for="firstName" class="form-label">
                        First Name<span class="required">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="firstName" 
                        name="firstName" 
                        class="form-input" 
                        placeholder="Enter your first name"
                        required
                    >
                </div>

                <div class="form-field">
                    <label for="lastName" class="form-label">
                        Last Name<span class="required">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="lastName" 
                        name="lastName" 
                        class="form-input" 
                        placeholder="Enter your last name"
                        required
                    >
                </div>

                <div class="form-field">
                    <label for="phone" class="form-label">
                        Phone Number<span class="required">*</span>
                    </label>
                    <input 
                        type="tel" 
                        id="phone" 
                        name="phone" 
                        class="form-input" 
                        placeholder="Enter your phone number"
                        required
                    >
                </div>

                <div class="form-field">
                    <label for="email" class="form-label">
                        Email Address<span class="required">*</span>
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-input" 
                        placeholder="Enter your email address"
                        required
                    >
                </div>

                <div class="form-field">
                    <label for="ageRange" class="form-label">
                        Age Range<span class="required">*</span>
                    </label>
                    <select id="ageRange" name="ageRange" class="form-select" required>
                        <option value="">Choose your age range</option>
                        <option value="16-24">16 - 24 years</option>
                        <option value="24-30">24 - 30 years</option>
                        <option value="30-40">30 - 40 years</option>
                        <option value="40-60">40 - 60 years</option>
                        <option value="60+">60+ years</option>
                    </select>
                </div>

                <div class="form-field">
                    <label for="attendance" class="form-label">
                        Attendance Type<span class="required">*</span>
                    </label>
                    <select id="attendance" name="attendanceType" class="form-select" required>
                        <option value="">Select attendance type</option>
                        <option value="Virtual">Virtual</option>
                        <option value="Physical">Physical</option>
                        <option value="Hybrid">Hybrid (Both)</option>
                    </select>
                </div>

                <div class="form-field">
                    <label for="country" class="form-label">
                        Country<span class="required">*</span>
                    </label>
                    <select id="country" name="country" class="form-select" required>
                        <option value="">Loading countries...</option>
                    </select>
                </div>

                <div class="form-field">
                    <label for="stateOfOrigin" class="form-label">
                        State/Province<span class="required">*</span>
                    </label>
                    <select id="stateOfOrigin" name="stateOfOrigin" class="form-select" required disabled>
                        <option value="">Select country first</option>
                    </select>
                </div>

                <div class="form-field full-width">
                    <label for="howDidYouHear" class="form-label">
                        How did you hear about us?<span class="required">*</span>
                    </label>
                    <select id="howDidYouHear" name="howDidYouHear" class="form-select" required>
                        <option value="">Select an option</option>
                        <option value="WhatsApp">WhatsApp</option>
                        <option value="Instagram">Instagram</option>
                        <option value="Facebook">Facebook</option>
                        <option value="Twitter">Twitter</option>
                        <option value="LinkedIn">LinkedIn</option>
                        <option value="Friend">Friend/Referral</option>
                        <option value="Google Search">Google Search</option>
                        <option value="Website">Website</option>
                        <option value="Email">Email</option>
                        <option value="Advertisement">Advertisement</option>
                        <option value="Event">Event/Conference</option>
                    </select>
                </div>
            </div>

            <button type="submit" class="submit-btn" id="submitBtn">
                Submit Registration
            </button>
        </form>
    </div>

    <script>
    // Set API base URL for development and production
    // Use relative URL for production, fallback to localhost for development
    window.API_BASE_URL = window.API_BASE_URL || (
        window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
            ? 'http://localhost:8000/Backend/api' 
            : '/Backend/api'
    );        // Global variables for countries and states data
        let countriesData = [];

        // Load countries on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadCountries();
            initializeFormFeatures();
        });

        async function loadCountries() {
            const countrySelect = document.getElementById('country');
            
            try {
                // Using REST Countries API
                const response = await fetch('https://restcountries.com/v3.1/all?fields=name,cca2');
                const countries = await response.json();
                
                // Sort countries alphabetically
                countries.sort((a, b) => a.name.common.localeCompare(b.name.common));
                
                // Clear loading message and populate countries
                countrySelect.innerHTML = '<option value="">Select your country</option>';
                
                countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.cca2; // Country code
                    option.textContent = country.name.common;
                    option.dataset.countryName = country.name.common;
                    countrySelect.appendChild(option);
                });
                
                // Store countries data globally
                countriesData = countries;
                
            } catch (error) {
                console.error('Error loading countries:', error);
                countrySelect.innerHTML = '<option value="">Error loading countries</option>';
            }
        }

        async function loadStates(countryCode) {
            const stateSelect = document.getElementById('stateOfOrigin');
            const selectedCountry = countriesData.find(c => c.cca2 === countryCode);
            
            if (!selectedCountry) return;
            
            // Show loading state
            stateSelect.innerHTML = '<option value="">Loading states...</option>';
            stateSelect.disabled = true;
            
            try {
                // Use REST Countries API for states/subdivisions
                const response = await fetch(`https://restcountries.com/v3.1/alpha/${countryCode}?fields=name,subdivisions`);
                const countryData = await response.json();
                
                // Try to get states from the subdivisions or use predefined data
                let states = [];
                
                // Predefined states for major countries
                const countryStates = {
                    'NG': [
                        "Abia", "Adamawa", "Akwa Ibom", "Anambra", "Bauchi", "Bayelsa", 
                        "Benue", "Borno", "Cross River", "Delta", "Ebonyi", "Edo", 
                        "Ekiti", "Enugu", "Federal Capital Territory (FCT)", "Gombe", 
                        "Imo", "Jigawa", "Kaduna", "Kano", "Katsina", "Kebbi", 
                        "Kogi", "Kwara", "Lagos", "Nasarawa", "Niger", "Ogun", 
                        "Ondo", "Osun", "Oyo", "Plateau", "Rivers", "Sokoto", 
                        "Taraba", "Yobe", "Zamfara"
                    ],
                    'US': [
                        "Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", 
                        "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii", "Idaho", 
                        "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", 
                        "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", 
                        "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", 
                        "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", 
                        "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", 
                        "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", 
                        "Washington", "West Virginia", "Wisconsin", "Wyoming", "District of Columbia"
                    ],
                    'CA': [
                        "Alberta", "British Columbia", "Manitoba", "New Brunswick", 
                        "Newfoundland and Labrador", "Northwest Territories", "Nova Scotia", 
                        "Nunavut", "Ontario", "Prince Edward Island", "Quebec", 
                        "Saskatchewan", "Yukon"
                    ],
                    'GB': [
                        "England", "Scotland", "Wales", "Northern Ireland"
                    ],
                    'AU': [
                        "New South Wales", "Victoria", "Queensland", "Western Australia", 
                        "South Australia", "Tasmania", "Australian Capital Territory", 
                        "Northern Territory"
                    ],
                    'IN': [
                        "Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh", 
                        "Goa", "Gujarat", "Haryana", "Himachal Pradesh", "Jharkhand", "Karnataka", 
                        "Kerala", "Madhya Pradesh", "Maharashtra", "Manipur", "Meghalaya", 
                        "Mizoram", "Nagaland", "Odisha", "Punjab", "Rajasthan", "Sikkim", 
                        "Tamil Nadu", "Telangana", "Tripura", "Uttar Pradesh", "Uttarakhand", 
                        "West Bengal", "Andaman and Nicobar Islands", "Chandigarh", 
                        "Dadra and Nagar Haveli and Daman and Diu", "Delhi", "Jammu and Kashmir", 
                        "Ladakh", "Lakshadweep", "Puducherry"
                    ],
                    'DE': [
                        "Baden-W√ºrttemberg", "Bavaria", "Berlin", "Brandenburg", "Bremen", 
                        "Hamburg", "Hesse", "Lower Saxony", "Mecklenburg-Vorpommern", 
                        "North Rhine-Westphalia", "Rhineland-Palatinate", "Saarland", 
                        "Saxony", "Saxony-Anhalt", "Schleswig-Holstein", "Thuringia"
                    ],
                    'FR': [
                        "Auvergne-Rh√¥ne-Alpes", "Bourgogne-Franche-Comt√©", "Brittany", 
                        "Centre-Val de Loire", "Corsica", "Grand Est", "Hauts-de-France", 
                        "√éle-de-France", "Normandy", "Nouvelle-Aquitaine", "Occitania", 
                        "Pays de la Loire", "Provence-Alpes-C√¥te d'Azur"
                    ],
                    'ZA': [
                        "Eastern Cape", "Free State", "Gauteng", "KwaZulu-Natal", "Limpopo", 
                        "Mpumalanga", "Northern Cape", "North West", "Western Cape"
                    ],
                    'KE': [
                        "Baringo", "Bomet", "Bungoma", "Busia", "Elgeyo-Marakwet", "Embu", 
                        "Garissa", "Homa Bay", "Isiolo", "Kajiado", "Kakamega", "Kericho", 
                        "Kiambu", "Kilifi", "Kirinyaga", "Kisii", "Kisumu", "Kitui", 
                        "Kwale", "Laikipia", "Lamu", "Machakos", "Makueni", "Mandera", 
                        "Marsabit", "Meru", "Migori", "Mombasa", "Murang'a", "Nairobi", 
                        "Nakuru", "Nandi", "Narok", "Nyamira", "Nyandarua", "Nyeri", 
                        "Samburu", "Siaya", "Taita-Taveta", "Tana River", "Tharaka-Nithi", 
                        "Trans Nzoia", "Turkana", "Uasin Gishu", "Vihiga", "Wajir", "West Pokot"
                    ],
                    'GH': [
                        "Ashanti", "Brong-Ahafo", "Central", "Eastern", "Greater Accra", 
                        "Northern", "Upper East", "Upper West", "Volta", "Western"
                    ],
                    'BR': [
                        "Acre", "Alagoas", "Amap√°", "Amazonas", "Bahia", "Cear√°", 
                        "Distrito Federal", "Esp√≠rito Santo", "Goi√°s", "Maranh√£o", 
                        "Mato Grosso", "Mato Grosso do Sul", "Minas Gerais", "Par√°", 
                        "Para√≠ba", "Paran√°", "Pernambuco", "Piau√≠", "Rio de Janeiro", 
                        "Rio Grande do Norte", "Rio Grande do Sul", "Rond√¥nia", "Roraima", 
                        "Santa Catarina", "S√£o Paulo", "Sergipe", "Tocantins"
                    ]
                };
                
                // Check if we have predefined states for this country
                if (countryStates[countryCode]) {
                    states = countryStates[countryCode];
                } else {
                    // For countries without predefined states, provide generic options
                    states = ["Province/State not specified", "Not applicable"];
                }
                
                // Populate the states dropdown
                stateSelect.innerHTML = '<option value="">Select your state/province</option>';
                states.forEach(state => {
                    const option = document.createElement('option');
                    option.value = state;
                    option.textContent = state;
                    stateSelect.appendChild(option);
                });
                
                stateSelect.disabled = false;
                
            } catch (error) {
                console.error('Error loading states:', error);
                stateSelect.innerHTML = '<option value="">Error loading states</option>';
                stateSelect.disabled = false;
            }
        }

        // Removed GeoNames dependency - now using predefined state data

        // Handle country selection change
        document.addEventListener('change', function(e) {
            if (e.target.id === 'country') {
                const countryCode = e.target.value;
                if (countryCode) {
                    loadStates(countryCode);
                } else {
                    const stateSelect = document.getElementById('stateOfOrigin');
                    stateSelect.innerHTML = '<option value="">Select country first</option>';
                    stateSelect.disabled = true;
                }
            }
        });

        async function handleSubmit(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const form = document.getElementById('registrationForm');
            
            // Disable submit button and show loading state
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Submitting...';
            
            try {
                // Get form data
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                
                // Add country name to data
                const countrySelect = document.getElementById('country');
                const selectedCountryOption = countrySelect.options[countrySelect.selectedIndex];
                if (selectedCountryOption && selectedCountryOption.dataset.countryName) {
                    data.countryName = selectedCountryOption.dataset.countryName;
                }
                
                console.log('Submitting form data:', data);
                
                    // Submit to backend API
                    const response = await fetch(window.API_BASE_URL + '/register.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                
                const result = await response.json();
                
                if (result.success) {
                    // Success response
                    Swal.fire({
                        icon: 'success',
                        title: 'Registration Successful!',
                        text: 'Registration successful, check your email for confirmation.',
                        confirmButtonText: 'Great!',
                        confirmButtonColor: '#2d5a3d',
                        showConfirmButton: true,
                        timer: 5000,
                        timerProgressBar: true
                    });
                    
                    // Reset form
                    form.reset();
                    
                    // Reset state dropdown
                    const stateSelect = document.getElementById('stateOfOrigin');
                    stateSelect.innerHTML = '<option value="">Select country first</option>';
                    stateSelect.disabled = true;
                    
                } else {
                    // Error response
                    let errorMessage = result.error || 'Registration failed';
                    if (result.details && Array.isArray(result.details)) {
                        errorMessage += '\n\nDetails:\n' + result.details.join('\n');
                    }
                    Swal.fire({
                        icon: 'error',
                        title: 'Registration Failed!',
                        text: errorMessage,
                        confirmButtonText: 'Try Again',
                        confirmButtonColor: '#d33',
                        showConfirmButton: true
                    });
                }
                
            } catch (error) {
                console.error('Submission error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Connection Error!',
                    text: 'Unable to connect to server. Please check your internet connection and try again.',
                    confirmButtonText: 'Retry',
                    confirmButtonColor: '#d33',
                    showConfirmButton: true
                });
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
                submitBtn.textContent = 'Submit Registration';
            }
        }

        function initializeFormFeatures() {
            const phoneInput = document.getElementById('phone');
            const emailInput = document.getElementById('email');
            
            // Phone number formatting (basic international format)
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^\d+\-\s()]/g, '');
                if (value.length > 20) {
                    value = value.slice(0, 20);
                }
                e.target.value = value;
            });
            
            // Email validation feedback
            emailInput.addEventListener('blur', function(e) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (e.target.value && !emailRegex.test(e.target.value)) {
                    e.target.style.borderColor = '#e74c3c';
                } else if (e.target.value) {
                    e.target.style.borderColor = '#27ae60';
                }
            });
            
            // Form field animations
            const inputs = document.querySelectorAll('.form-input, .form-select');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.style.transform = 'translateY(-2px)';
                });
                
                input.addEventListener('blur', function() {
                    this.parentElement.style.transform = 'translateY(0)';
                });
            });
        }
    </script>
</body>
</html>